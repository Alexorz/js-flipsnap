/**
 * flipsnap.js
 *
 * @version  0.6.2
 * @url http://pxgrid.github.com/js-flipsnap/
 *
 * Copyright 2011 PixelGrid, Inc.
 * Licensed under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 */
!function(t,e,n){function o(t,e){return this instanceof o?this.init(t,e):new o(t,e)}function r(t,e){return t.changedTouches?t.changedTouches[0][e]:t[e]}function i(t){return c(t,function(t){return v.style[t]!==n})}function a(t,e,o){var r=d[e];r?t[r]=o:t[e]!==n?(d[e]=e,t[e]=o):c(f,function(r){var i=u(r)+u(e);return t[i]!==n?(d[e]=i,t[i]=o,!0):void 0})}function s(t){if(v.style[t]!==n)return t;var e;return c(f,function(o){var r=u(o)+u(t);return v.style[r]!==n?(e="-"+o+"-"+t,!0):void 0}),e}function u(t){return t.charAt(0).toUpperCase()+t.substr(1)}function c(t,e){for(var n=0,o=t.length;o>n;n++)if(e(t[n],n))return!0;return!1}function m(t,e,n,o){var r=Math.abs(t-n),i=Math.abs(e-o),a=Math.sqrt(Math.pow(r,2)+Math.pow(i,2));return{x:r,y:i,z:a}}function l(t){var e=t.y/t.z,n=Math.acos(e);return 180/(Math.PI/n)}var v=e.createElement("div"),f=["webkit","moz","o","ms"],d={},p=o.support={},h=!1,P=5,y=55;p.transform3d=i(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]),p.transform=i(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"]),p.transition=i(["transitionProperty","WebkitTransitionProperty","MozTransitionProperty","OTransitionProperty","msTransitionProperty"]),p.addEventListener="addEventListener"in t,p.mspointer=t.navigator.msPointerEnabled,p.cssAnimation=(p.transform3d||p.transform)&&p.transition;for(var _=["touch","mouse"],T={start:{touch:"touchstart",mouse:"mousedown"},move:{touch:"touchmove",mouse:"mousemove"},end:{touch:"touchend",mouse:"mouseup"}},g=t.requestAnimationFrame,E=0;E<f.length&&!g;++E)g=t[f[E]+"RequestAnimationFrame"];g||(g=function(t){t()}),p.addEventListener&&(e.addEventListener("gesturestart",function(){h=!0}),e.addEventListener("gestureend",function(){h=!1})),o.prototype.init=function(t,o){var r=this;if(r.element=t,"string"==typeof t&&(r.element=e.querySelector(t)),!r.element)throw new Error("element not found");return p.mspointer&&(r.element.style.msTouchAction="pan-y"),o=o||{},r.distance=o.distance,r.maxPoint=o.maxPoint,r.disableTouch=o.disableTouch===n?!1:o.disableTouch,r.disableCssTransition=o.disableCssTransition===n?!1:o.disableCssTransition,r.disable3d=o.disable3d===n?!1:o.disable3d,r.transitionDuration=o.transitionDuration===n?350:o.transitionDuration,r.currentPoint=0,r.currentX=0,r.animation=!1,r.use3d=p.transform3d,r.disable3d===!0&&(r.use3d=!1),r._setStyle(p.cssAnimation?{transitionProperty:s("transform"),transitionTimingFunction:"cubic-bezier(0,0,0.25,1)",transitionDuration:"0ms",transform:r._getTranslate(0)}:{position:"relative",left:"0px"}),r.refresh(),_.forEach(function(t){r.element.addEventListener(T.start[t],r,!1)}),r},o.prototype.handleEvent=function(t){var e=this;switch(t.type){case T.start.touch:e._touchStart(t,"touch");break;case T.start.mouse:e._touchStart(t,"mouse");break;case T.move.touch:e._touchMove(t,"touch");break;case T.move.mouse:e._touchMove(t,"mouse");break;case T.end.touch:e._touchEnd(t,"touch");break;case T.end.mouse:e._touchEnd(t,"mouse");break;case"click":e._click(t)}},o.prototype.refresh=function(){var t=this;t._maxPoint=t.maxPoint===n?function(){for(var e,n=t.element.childNodes,o=-1,r=0,i=n.length;i>r;r++)e=n[r],1===e.nodeType&&o++;return o}():t.maxPoint,t._distance=t.distance===n?t._maxPoint<0?0:t.element.scrollWidth/(t._maxPoint+1):t.distance,t._maxX=-t._distance*t._maxPoint,t.moveToPoint()},o.prototype.hasNext=function(){var t=this;return t.currentPoint<t._maxPoint},o.prototype.hasPrev=function(){var t=this;return t.currentPoint>0},o.prototype.toNext=function(t){var e=this;e.hasNext()&&e.moveToPoint(e.currentPoint+1,t)},o.prototype.toPrev=function(t){var e=this;e.hasPrev()&&e.moveToPoint(e.currentPoint-1,t)},o.prototype.moveToPoint=function(t,e,o){var r=this;o||(clearTimeout(r._moveendTimeout),clearTimeout(r._autoPlayTimeout),r._triggerEvent("fsmovestart",!0,!1)),e=e===n?r.transitionDuration:e;var i=r.currentPoint;t===n&&(t=r.currentPoint),r.currentPoint=0>t?0:t>r._maxPoint?r._maxPoint:parseInt(t,10);var a={moved:i!==r.currentPoint,originalPoint:i,newPoint:r.currentPoint},s=function(){r._triggerEvent("fsmoveend",!0,!1,a),r._autoPlay()};!p.cssAnimation||r.disableCssTransition||o?r.animation=!0:(r._setStyle({transitionDuration:e+"ms"}),r._moveendTimeout=setTimeout(s,e)),r._setX(-r.currentPoint*r._distance,e,o,s),a.moved&&r._triggerEvent("fspointmove",!0,!1,a)},o.prototype._setX=function(t,e,n,o){var r=this;r.animation?!p.cssAnimation||r.disableCssTransition||n?r._animate(t,e||r.transitionDuration,o):r.element.style[d.transform]=r._getTranslate(t):(p.cssAnimation?r.element.style[d.transform]=r._getTranslate(t):r.element.style.left=t+"px",r.currentX=t)},o.prototype._touchStart=function(t,n){var o=this;if(!(o.disableTouch||o.scrolling||h)){clearInterval(o._animateTimer),clearTimeout(o._moveendTimeout),clearTimeout(o._autoPlayTimeout),o.element.addEventListener(T.move[n],o,!1),e.addEventListener(T.end[n],o,!1);var i=t.target.tagName;"mouse"===n&&"SELECT"!==i&&"INPUT"!==i&&"TEXTAREA"!==i&&"BUTTON"!==i&&t.preventDefault(),p.cssAnimation&&o._setStyle({transitionDuration:"0ms"}),o.animation=!1,o.scrolling=!0,o.moveReady=!1,o.startPageX=r(t,"pageX"),o.startPageY=r(t,"pageY"),o.basePageX=o.startPageX,o.directionX=0,o.startTime=t.timeStamp,o._triggerEvent("fstouchstart",!0,!1)}},o.prototype._touchMove=function(t){var e=this;if(e.scrolling&&!h){var o,i,a=r(t,"pageX"),s=r(t,"pageY");if(e.moveReady){t.preventDefault(),o=a-e.basePageX,i=e.currentX+o,(i>=0||i<e._maxX)&&(i=Math.round(e.currentX+o/3)),e.directionX=0===o?e.directionX:o>0?-1:1;var u=!e._triggerEvent("fstouchmove",!0,!0,{delta:o,direction:e.directionX});e._triggerEvent("fsmove",!0,!0,{absoluteX:i}),u?e._touchAfter({moved:!1,originalPoint:e.currentPoint,newPoint:e.currentPoint,cancelled:!0}):e._setX(i)}else{var c=m(e.startPageX,e.startPageY,a,s);c.z>P&&(l(c)>y?(t.preventDefault(),e.moveReady=!0,e.element.addEventListener("click",e,!0),e._triggerEvent("fsmovestart",!0,!1)):(e.scrolling=!1,-1*e.currentPoint*e._distance!=e.currentX&&e.moveToPoint(n,n,!0),e._autoPlay()))}e.basePageX=a}},o.prototype._touchEnd=function(t,o){var r=this;if(r.element.removeEventListener(T.move[o],r,!1),e.removeEventListener(T.end[o],r,!1),r.scrolling){var i=-r.currentX/r._distance;i=r.directionX>0?Math.ceil(i):r.directionX<0?Math.floor(i):Math.round(i),0>i?i=0:i>r._maxPoint&&(i=r._maxPoint),r._touchAfter({moved:i!==r.currentPoint,originalPoint:r.currentPoint,newPoint:i,cancelled:!1}),r.moveToPoint(i,n,!0)}},o.prototype._click=function(t){t.stopPropagation(),t.preventDefault()},o.prototype._touchAfter=function(t){var e=this;e.scrolling=!1,e.moveReady=!1,setTimeout(function(){e.element.removeEventListener("click",e,!0)},200),e._triggerEvent("fstouchend",!0,!1,t)},o.prototype.autoPlay=function(t){return this.enableAutoPlay=!0,this.autoPlayDuration=t||this.autoPlayDuration||4e3,this._autoPlay(),this},o.prototype.stopAutoPlay=function(){return this.enableAutoPlay=!1,clearTimeout(this._autoPlayTimeout),this},o.prototype._autoPlay=function(){var t=this;t.enableAutoPlay&&(clearTimeout(t._autoPlayTimeout),t._autoPlayTimeout=setTimeout(function(){g(function(){t.hasNext()?t.toNext():t.moveToPoint(0),t._autoPlay()})},t.autoPlayDuration))},o.prototype._setStyle=function(t){var e=this,n=e.element.style;for(var o in t)a(n,o,t[o])},o.prototype._setElementStyle=a,o.prototype._animate=function(t,e,n){var o=this,r=o.element,i=+new Date,s=o.currentX,u=t,c=e,m=function(t,e){return-(t/=e)*(t-2)};o._animateTimer=setInterval(function(){var t,e,l=new Date-i;l>c?(clearInterval(o._animateTimer),e=u,setTimeout(function(){"function"==typeof n&&n()},100/6)):(t=m(l,c),e=t*(u-s)+s),p.cssAnimation?a(r.style,"transform",o._getTranslate(e)):r.style.left=e+"px",o.currentX=e,o._triggerEvent("fsmove",!0,!0,{absoluteX:e})},100/6)},o.prototype.destroy=function(){var t=this;_.forEach(function(e){t.element.removeEventListener(T.start[e],t,!1)})},o.prototype._getTranslate=function(t){var e=this;return e.use3d?"translate3d("+t+"px, 0, 0)":"translate("+t+"px, 0)"},o.prototype._triggerEvent=function(t,n,o,r){var i=this,a=e.createEvent("Event");if(a.initEvent(t,n,o),r)for(var s in r)r.hasOwnProperty(s)&&(a[s]=r[s]);return i.element.dispatchEvent(a)},"object"==typeof exports?module.exports=o:"function"==typeof define&&define.amd?define(function(){return o}):t.Flipsnap=o}(window,window.document);