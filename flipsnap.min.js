/**
 * flipsnap.js
 *
 * @version  0.5.0
 * @url http://pxgrid.github.com/js-flipsnap/
 *
 * Copyright 2011 PixelGrid, Inc.
 * Licensed under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(e,t,n){function c(e,t){return this instanceof c?this.init(e,t):new c(e,t)}function h(e,t){return o.touch?e.changedTouches[0][t]:e[t]}function p(e){return g(e,function(e){return r.style[e]!==n})}function d(e,t,r){var o=s[t];o?e[o]=r:e[t]!==n?(s[t]=t,e[t]=r):g(i,function(i){var o=m(i)+m(t);if(e[o]!==n)return s[t]=o,e[o]=r,!0})}function v(e){if(r.style[e]!==n)return e;var t;return g(i,function(i){var s=m(i)+m(e);if(r.style[s]!==n)return t="-"+i+"-"+e,!0}),t}function m(e){return e.charAt(0).toUpperCase()+e.substr(1)}function g(e,t){for(var n=0,r=e.length;n<r;n++)if(t(e[n],n))return!0;return!1}function y(e,n,r,i,s){var o=t.createEvent("Event");o.initEvent(n,r,i);if(s)for(var u in s)o[u]=s[u];return e.dispatchEvent(o)}var r=t.createElement("div"),i=["webkit","moz","o","ms"],s={},o={},u=!1;o.transform3d=p(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]),o.transform=p(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"]),o.transition=p(["transitionProperty","WebkitTransitionProperty","MozTransitionProperty","OTransitionProperty","msTransitionProperty"]),o.touch="ontouchstart"in e,o.mspointer=e.navigator.msPointerEnabled,o.cssAnimation=(o.transform3d||o.transform)&&o.transition;var a=o.mspointer?"MSPointerDown":o.touch?"touchstart":"mousedown",f=o.mspointer?"MSPointerMove":o.touch?"touchmove":"mousemove",l=o.mspointer?"MSPointerUp":o.touch?"touchend":"mouseup";t.addEventListener("gesturestart",function(){u=!0}),t.addEventListener("gestureend",function(){u=!1}),c.prototype.init=function(e,r){var i=this;i.element=e,typeof e=="string"&&(i.element=t.querySelector(e));if(!i.element)throw new Error("element not found");return o.mspointer&&(i.element.style.msTouchAction="none"),r=r||{},i.distance=r.distance,i.maxPoint=r.maxPoint,i.disableTouch=r.disableTouch===n?!1:r.disableTouch,i.disable3d=r.disable3d===n?!1:r.disable3d,i.transitionDuration=r.transitionDuration===n?"350ms":r.transitionDuration+"ms",i.currentPoint=0,i.currentX=0,i.animation=!1,i.use3d=o.transform3d,i.disable3d===!0&&(i.use3d=!1),o.cssAnimation?i._setStyle({transitionProperty:v("transform"),transitionTimingFunction:"cubic-bezier(0,0,0.25,1)",transitionDuration:"0ms",transform:i._getTranslate(0)}):i._setStyle({position:"relative",left:"0px"}),i.refresh(),i.element.addEventListener(a,i,!1),i.element.addEventListener(f,i,!1),i},c.prototype.handleEvent=function(e){var t=this;switch(e.type){case a:t._touchStart(e);break;case f:t._touchMove(e);break;case l:t._touchEnd(e);break;case"click":t._click(e)}},c.prototype.refresh=function(){var e=this;e._maxPoint=e.maxPoint===n?function(){var t=e.element.childNodes,n=0,r=0,i=t.length,s;for(;r<i;r++)s=t[r],s.nodeType===1&&n++;return n>0&&n--,n}():e.maxPoint,e._distance=e.distance===n?e.element.scrollWidth/(e._maxPoint+1):e.distance,e._maxX=-e._distance*e._maxPoint,e.moveToPoint()},c.prototype.hasNext=function(){var e=this;return e.currentPoint<e._maxPoint},c.prototype.hasPrev=function(){var e=this;return e.currentPoint>0},c.prototype.toNext=function(e){var t=this;if(!t.hasNext())return;t.moveToPoint(t.currentPoint+1,e)},c.prototype.toPrev=function(e){var t=this;if(!t.hasPrev())return;t.moveToPoint(t.currentPoint-1,e)},c.prototype.moveToPoint=function(e,t){var r=this;t=t===n?r.transitionDuration:t;var i=r.currentPoint;e===n&&(e=r.currentPoint),e<0?r.currentPoint=0:e>r._maxPoint?r.currentPoint=r._maxPoint:r.currentPoint=parseInt(e,10),o.cssAnimation?r._setStyle({transitionDuration:t}):r.animation=!0,r._setX(-r.currentPoint*r._distance),i!==r.currentPoint&&(y(r.element,"fsmoveend",!0,!1),y(r.element,"fspointmove",!0,!1))},c.prototype._setX=function(e){var t=this;t.currentX=e,o.cssAnimation?t.element.style[s.transform]=t._getTranslate(e):t.animation?t._animate(e,t.transitionDuration):t.element.style.left=e+"px"},c.prototype._touchStart=function(e){var n=this;if(n.disableTouch||u)return;t.addEventListener(l,n,!1),o.touch||e.preventDefault(),o.cssAnimation?n._setStyle({transitionDuration:"0ms"}):n.animation=!1,n.scrolling=!0,n.moveReady=!1,n.startPageX=h(e,"pageX"),n.startPageY=h(e,"pageY"),n.basePageX=n.startPageX,n.directionX=0,n.startTime=e.timeStamp,y(n.element,"fstouchstart",!0,!1)},c.prototype._touchMove=function(e){var t=this;if(!t.scrolling||u)return;var n=h(e,"pageX"),r=h(e,"pageY"),i,s,o,a;if(t.moveReady){e.preventDefault(),e.stopPropagation(),i=n-t.basePageX,s=t.currentX+i;if(s>=0||s<t._maxX)s=Math.round(t.currentX+i/3);t.directionX=i===0?t.directionX:i>0?-1:1;var f=!y(t.element,"fstouchmove",!0,!0,{delta:i,direction:t.directionX});f?t._touchAfter({moved:!1,originalPoint:t.currentPoint,newPoint:t.currentPoint,cancelled:!0}):t._setX(s)}else o=Math.abs(n-t.startPageX),a=Math.abs(r-t.startPageY),o>5?(e.preventDefault(),e.stopPropagation(),t.moveReady=!0,t.element.addEventListener("click",t,!0)):a>5&&(t.scrolling=!1);t.basePageX=n},c.prototype._touchEnd=function(e){var n=this;t.removeEventListener(l,n,!1);if(!n.scrolling)return;var r=-n.currentX/n._distance;r=n.directionX>0?Math.ceil(r):n.directionX<0?Math.floor(r):Math.round(r),r<0?r=0:r>n._maxPoint&&(r=n._maxPoint),n._touchAfter({moved:r!==n.currentPoint,originalPoint:n.currentPoint,newPoint:r,cancelled:!1}),n.moveToPoint(r)},c.prototype._click=function(e){var t=this;e.stopPropagation(),e.preventDefault()},c.prototype._touchAfter=function(e){var t=this;t.scrolling=!1,t.moveReady=!1,setTimeout(function(){t.element.removeEventListener("click",t,!0)},200),y(t.element,"fstouchend",!0,!1,e)},c.prototype._setStyle=function(e){var t=this,n=t.element.style;for(var r in e)d(n,r,e[r])},c.prototype._animate=function(e,t){var n=this,r=n.element,i=+(new Date),s=parseInt(r.style.left,10),o=e,u=t,a=function(e,t){return-(e/=t)*(e-2)},f=setInterval(function(){var e=new Date-i,t,n;e>u?(clearInterval(f),n=o):(t=a(e,u),n=t*(o-s)+s),r.style.left=n+"px"},10)},c.prototype.destroy=function(){var e=this;e.element.removeEventListener(a,e),e.element.removeEventListener(f,e)},c.prototype._getTranslate=function(e){var t=this;return t.use3d?"translate3d("+e+"px, 0, 0)":"translate("+e+"px, 0)"},e.Flipsnap=c})(window,window.document);