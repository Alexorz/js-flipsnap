/**
 * flipsnap.js
 *
 * @version  0.6.2
 * @url http://pxgrid.github.com/js-flipsnap/
 *
 * Copyright 2011 PixelGrid, Inc.
 * Licensed under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 */
!function(t,e,n){function o(t,e){return this instanceof o?this.init(t,e):new o(t,e)}function r(t,e){return t.changedTouches?t.changedTouches[0][e]:t[e]}function i(t){return m(t,function(t){return v.style[t]!==n})}function a(t,e,o){var r=d[e];r?t[r]=o:t[e]!==n?(d[e]=e,t[e]=o):m(f,function(r){var i=c(r)+c(e);return t[i]!==n?(d[e]=i,t[i]=o,!0):void 0})}function s(e){var n=e.ownerDocument.defaultView.opener?e.ownerDocument.defaultView.getComputedStyle(e,null):t.getComputedStyle(e,null);return e.offsetWidth+Number((n["margin-left"]||"").slice(0,-2))+Number((n["margin-left"]||"").slice(0,-2))}function u(t){if(v.style[t]!==n)return t;var e;return m(f,function(o){var r=c(o)+c(t);return v.style[r]!==n?(e="-"+o+"-"+t,!0):void 0}),e}function c(t){return t.charAt(0).toUpperCase()+t.substr(1)}function m(t,e){for(var n=0,o=t.length;o>n;n++)if(e(t[n],n))return!0;return!1}function l(t,e,n,o){var r=Math.abs(t-n),i=Math.abs(e-o),a=Math.sqrt(Math.pow(r,2)+Math.pow(i,2));return{x:r,y:i,z:a}}function p(t){var e=t.y/t.z,n=Math.acos(e);return 180/(Math.PI/n)}var v=e.createElement("div"),f=["webkit","moz","o","ms"],d={},h=o.support={},P=!1,y=5,_=55;h.transform3d=i(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]),h.transform=i(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"]),h.transition=i(["transitionProperty","WebkitTransitionProperty","MozTransitionProperty","OTransitionProperty","msTransitionProperty"]),h.addEventListener="addEventListener"in t,h.mspointer=t.navigator.msPointerEnabled,h.cssAnimation=h.transform3d&&h.transition;for(var g=t.requestAnimationFrame,T=0;T<f.length&&!g;++T)g=t[f[T]+"RequestAnimationFrame"];g||(g=function(t){t()});var b=["touch","mouse"],E={start:{touch:"touchstart",mouse:"mousedown"},move:{touch:"touchmove",mouse:"mousemove"},end:{touch:"touchend",mouse:"mouseup"}};h.addEventListener&&(e.addEventListener("gesturestart",function(){P=!0}),e.addEventListener("gestureend",function(){P=!1})),o.prototype.init=function(t,o){var r=this;if(r.element=t,"string"==typeof t&&(r.element=e.querySelector(t)),!r.element)throw new Error("element not found");return h.mspointer&&(r.element.style.msTouchAction="pan-y"),o=r.opts=o||{},r.distance=n,r.disableTouch=o.disableTouch===n?!1:o.disableTouch,r.disableCssTransition=o.disableCssTransition===n?!1:o.disableCssTransition,r.disable3d=o.disable3d===n?!1:o.disable3d,r.transitionDuration=o.transitionDuration===n?350:o.transitionDuration,r.loop=!!o.loop,r.autoPlayDuration=isNaN(o.autoPlayDuration)?4e3:Number(o.autoPlayDuration),r._enableAutoPlay=o.autoPlay===n?!1:o.autoPlay,r.itemWidth=isNaN(o.itemWidth)?null:Number(o.itemWidth),r.currentPoint=0,r._currentPoint=0,r.maxPoint=n,r._maxPoint=n,r.currentX=0,r.animation=!1,r.use3d=h.transform3d,r.disable3d===!0&&(r.use3d=!1),r._setStyle(h.cssAnimation?{transitionProperty:u("transform"),transitionTimingFunction:"cubic-bezier(0,0,0.5,1)",transitionDuration:"0ms",transform:r._getTranslate(0)}:{position:"relative",left:"0px"}),r.refresh(),b.forEach(function(t){r.element.addEventListener(E.start[t],r,!1)}),r},o.prototype.handleEvent=function(t){var e=this;switch(t.type){case E.start.touch:e._touchStart(t,"touch");break;case E.start.mouse:e._touchStart(t,"mouse");break;case E.move.touch:e._touchMove(t,"touch");break;case E.move.mouse:e._touchMove(t,"mouse");break;case E.end.touch:e._touchEnd(t,"touch");break;case E.end.mouse:e._touchEnd(t,"mouse");break;case"click":e._click(t)}},o.prototype.refresh=function(){var t=this;t.pauseAutoPlay(),t.firstLoopFaker&&(t.element.removeChild(t.firstLoopFaker),t.firstLoopFaker=null),t.lastLoopFaker&&(t.element.removeChild(t.lastLoopFaker),t.lastLoopFaker=null);var e=function(){for(var e,n=t.element.childNodes,o=0,r=n.length,i=[];r>o;o++)e=n[o],1===e.nodeType&&i.push(e);return i}();if(t.itemLength=t._itemLength=e.length,t.maxPoint=t._maxPoint=t.opts.maxPoint===n?t._itemLength-1:t.opts.maxPoint,t.loop){var o=t.element.firstElementChild,r=t.element.lastElementChild;t.firstLoopFaker=o.cloneNode(!0),t.lastLoopFaker=r.cloneNode(!0),t.element.appendChild(t.firstLoopFaker),t.element.insertBefore(t.lastLoopFaker,t.element.firstElementChild),t._itemLength=0===t._itemLength?0:t._itemLength+2,t._maxPoint=0===t._maxPoint?0:t._maxPoint+2}t.scrollWidth=t._itemLength*(t.itemWidth||s(e[0])),t.element.style.width=t.scrollWidth+"px",t.updateDistance(),t._maxX=-t._distance*t._maxPoint,t.moveToPoint(t.currentPoint||0,0),t.isAutoPlayEnable()&&t.resumeAutoPlay()},o.prototype.updateDistance=function(){var t=this;t._distance=t.opts.distance===n?t._maxPoint<0?0:t.scrollWidth/(t._maxPoint+1):t.opts.distance},o.prototype.hasNext=function(){var t=this;return t.loop?!0:t.currentPoint<t.maxPoint},o.prototype.hasPrev=function(){var t=this;return t.loop?!0:t.currentPoint>0},o.prototype.toNext=function(t){var e=this;e.hasNext()&&(e.loop&&e.currentPoint>=e.maxPoint?(e.animation=!1,e._setStyle({transitionDuration:"0ms"}),setTimeout(function(){e._setX(0,0),setTimeout(function(){e.moveToPoint(0,t)},0)},0)):e.moveToPoint(e.currentPoint+1,t))},o.prototype.toPrev=function(t){var e=this;e.hasPrev()&&(e.loop&&0===e.currentPoint?(e.animation=!1,e._setStyle({transitionDuration:"0ms"}),setTimeout(function(){e._setX(e._maxX,0),setTimeout(function(){e.moveToPoint(e.maxPoint,t)},0)},0)):e.moveToPoint(e.currentPoint-1,t))},o.prototype._realPointToUserPoint=function(t){var e=this;return e.loop?1>t?e.maxPoint:t-1:t},o.prototype.moveToPoint=function(t,e,o){var r=this;t===n?t=r.currentPoint:0>t||isNaN(t)?t=0:t>r.maxPoint&&(t=r.maxPoint),r._moveToPoint(r.loop?t+1:t,e,o)},o.prototype._moveToPoint=function(t,e,o){var r=this;clearTimeout(r._moveendTimeout),clearTimeout(r._autoPlayTimeout),o||r._triggerEvent("fsmovestart",!0,!1),e=e===n?r.transitionDuration:e;{var i=r._realPointToUserPoint(t),a=r.currentPoint;r._currentPoint}r.currentPoint=i,r._currentPoint=t;var s={moved:a!==r.currentPoint,originalPoint:a,newPoint:r.currentPoint},u=function(){r._triggerEvent("fsmoveend",!0,!1,s),r.resumeAutoPlay()};h.cssAnimation&&!r.disableCssTransition?(r._setStyle({transitionDuration:e+"ms"}),r._moveendTimeout=setTimeout(u,e)):0!==e&&(r.animation=!0),r._setX(-r._currentPoint*r._distance,e,u),s.moved&&r._triggerEvent("fspointmove",!0,!1,s)},o.prototype._setX=function(t,e,n){var o=this;o.animation?h.cssAnimation&&!o.disableCssTransition?(o.element.style[d.transform]=o._getTranslate(t),o.currentX=t):o._animate(t,e||o.transitionDuration,n):(h.cssAnimation?o.element.style[d.transform]=o._getTranslate(t):o.element.style.left=t+"px",o.currentX=t)},o.prototype._touchStart=function(t,n){var o=this;if(!(o.disableTouch||o.scrolling||P)){clearInterval(o._animateTimer),clearTimeout(o._moveendTimeout),o.pauseAutoPlay(),o.element.addEventListener(E.move[n],o,!1),e.addEventListener(E.end[n],o,!1);var i=t.target.tagName;"mouse"===n&&"SELECT"!==i&&"INPUT"!==i&&"TEXTAREA"!==i&&"BUTTON"!==i&&t.preventDefault(),h.cssAnimation&&o._setStyle({transitionDuration:"0ms"}),o.animation=!1,o.scrolling=!0,o.moveReady=!1,o.startPageX=r(t,"pageX"),o.startPageY=r(t,"pageY"),o.basePageX=o.startPageX,o.directionX=0,o.startTime=t.timeStamp,o._triggerEvent("fstouchstart",!0,!1)}},o.prototype._touchMove=function(t){var e=this;if(e.scrolling&&!P){var o,i,a,s=r(t,"pageX"),u=r(t,"pageY");if(e.moveReady){if(t.preventDefault(),o=s-e.basePageX,i=e.currentX+o,(i>=0||i<e._maxX)&&(i=Math.round(e.currentX+o/3)),a=e.directionX=0===o?e.directionX:o>0?-1:1,e.loop){var c=-1*e._distance,m=-1*e._distance*(e._itemLength-2);-1==a?e.currentX<=c&&i>c?i=e._maxX+i-c:e.currentX>c&&i>=0&&(i=m+i):1==a&&(e.currentX>=m&&m>i?i=0+i-m:e.currentX<m&&i<=e._maxX&&(i=c+i-e._maxX))}var v=!e._triggerEvent("fstouchmove",!0,!0,{delta:o,direction:e.directionX});e._triggerEvent("fsmove",!0,!0,{absoluteX:i}),v?e._touchAfter({moved:!1,originalPoint:e.currentPoint,newPoint:e.currentPoint,cancelled:!0}):e._setX(i)}else{var f=l(e.startPageX,e.startPageY,s,u);f.z>y&&(p(f)>_?(t.preventDefault(),e.moveReady=!0,e.element.addEventListener("click",e,!0),e._triggerEvent("fsmovestart",!0,!1)):(e._touchAfter({moved:!1,originalPoint:e.currentPoint,newPoint:e.currentPoint}),h.cssAnimation&&!e.disableCssTransition||-1*e.currentPoint*e._distance==e.currentX||e.moveToPoint(n,n,!0),e.resumeAutoPlay()))}e.basePageX=s}},o.prototype._touchEnd=function(t,o){var r=this;if(r.element.removeEventListener(E.move[o],r,!1),e.removeEventListener(E.end[o],r,!1),r.scrolling){var i,a=-r.currentX/r._distance;a=r.directionX>0?Math.ceil(a):r.directionX<0?Math.floor(a):Math.round(a),0>a?a=0:a>r._maxPoint&&(a=r._maxPoint),i=r._realPointToUserPoint(a),r._touchAfter({moved:i!==r.currentPoint,originalPoint:r.currentPoint,newPoint:i,cancelled:!1}),r._moveToPoint(a,n,!0)}},o.prototype._click=function(t){t.stopPropagation(),t.preventDefault()},o.prototype._touchAfter=function(t){var e=this;e.scrolling=!1,e.moveReady=!1,setTimeout(function(){e.element.removeEventListener("click",e,!0)},200),e._triggerEvent("fstouchend",!0,!1,t)},o.prototype.isAutoPlayEnable=function(){return this._enableAutoPlay&&this.itemLength>1},o.prototype.autoPlay=function(){return this.enableAutoPlay=!0,this.resumeAutoPlay()},o.prototype.cancleAutoPlay=function(){return this.enableAutoPlay=!1,this.pauseAutoPlay()},o.prototype.pauseAutoPlay=function(){return clearTimeout(this._autoPlayTimeout),this},o.prototype.resumeAutoPlay=function(){var t=this;return t.isAutoPlayEnable()&&(clearTimeout(t._autoPlayTimeout),t._autoPlayTimeout=setTimeout(function(){g(function(){t.hasNext()?t.toNext():t.moveToPoint(0),t.resumeAutoPlay()})},t.autoPlayDuration)),this},o.prototype._setStyle=function(t){var e=this,n=e.element.style;for(var o in t)a(n,o,t[o])},o.prototype._animate=function(t,e,n){var o=this,r=o.element,i=+new Date,s=o.currentX,u=t,c=e,m=function(t,e){return-(t/=e)*(t-2)};o._animateTimer=setInterval(function(){var t,e,l=new Date-i;l>c?(clearInterval(o._animateTimer),e=u,setTimeout(function(){"function"==typeof n&&n()},100/6)):(t=m(l,c),e=t*(u-s)+s),h.cssAnimation?a(r.style,"transform",o._getTranslate(e)):r.style.left=e+"px",o.currentX=e,o._triggerEvent("fsmove",!0,!0,{absoluteX:e})},100/6)},o.prototype.destroy=function(){var t=this;b.forEach(function(e){t.element.removeEventListener(E.start[e],t,!1)})},o.prototype._getTranslate=function(t){var e=this;return e.use3d?"translate3d("+t+"px, 0, 0)":"translate("+t+"px, 0)"},o.prototype._triggerEvent=function(t,n,o,r){var i=this,a=e.createEvent("Event");if(a.initEvent(t,n,o),r)for(var s in r)r.hasOwnProperty(s)&&(a[s]=r[s]);return i.element.dispatchEvent(a)},o.prototype.setStyle=a,"object"==typeof exports?module.exports=o:"function"==typeof define&&define.amd?define(function(){return o}):t.Flipsnap=o}(window,window.document);